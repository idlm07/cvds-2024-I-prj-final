<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style_productos.css"> <!-- Enlace a la hoja de estilos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Iconos -->
    <title>Productos - TopGear</title>
</head>
<body>
    <div class="container">
        <div>
            <img class="logo" src="/static/logo_2.png" alt="TopGear Logo">
        </div>
        <div>
            <button class="circular-button" onclick="goToCarrito()">
                <i class="fas fa-shopping-cart"></i>
            </button>
        </div>
    </div>

    <div class="container_query_bar">
        <form class="query_bar" action="/search" method="GET"> 
            <input type="search" name="q" placeholder="Buscar..." class="query_input">
            <button type="submit" class="query_button">
                <i class="fas fa-search"></i>
            </button>
        </form>
    </div>

    <div>
        <h2>
            ¿Que producto o servicio necesitas? 
        </h2>
    </div>

    <div class="container_products" id="productos-container">
        <!-- Productos dinámicos se insertarán aquí -->
    </div>

    <div class="ingesa">
        <div class="container">

        </div>
    </div>

    <div class="container_social_media">
        <div class="icon-grid">
            <div class="icon-item" onclick="handleClick('instagram')">
                <i class="fab fa-instagram"></i>
            </div>
            <div class="icon-item" onclick="handleClick('whatsapp')">
                <i class="fab fa-whatsapp"></i>
            </div>
        </div>
    </div>

    <a href="feature_public.html">Volver</a>

    <script>
        function goToCarrito() {
            window.location.href = "carrito.html";
        }

        function handleClick(platform) {
            if(platform == 'instagram'){
                window.location.href = "https://www.instagram.com/topgearbogota/";
            } else {
                window.location.href = "https://api.whatsapp.com/send/?phone=573153764044&text=Hola+%2ATopGear+Bogot%C3%A1%2A.+Necesito+que+me+ayuden+con+...&type=phone_number&app_absent=0";
            }
            //console.log(`Icono de ${platform} clickeado`);
        }

        fetch('/api/products') 
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('productos-container');

                const formatAsCurrency = (value) => {
                const formatter = new Intl.NumberFormat('en-CO', {
                style: 'currency',
                currency: 'COP'
                });

                return formatter.format(value);
                 };

                data.forEach(product => {
                    // Crear contenedor para el producto
                    const productContainer = document.createElement('div');
                    productContainer.classList.add('container_product');

                    if (product.iconUrl) {
                        const productImage = document.createElement('img');
                        const productValue = document.createElement('label');
                        productImage.src = product.iconUrl; 
                        productImage.alt = `Imagen de ${product.nombre}`; 
                        productContainer.appendChild(productImage);
                    }

                    if (product.value != 0) {
                        const productValue = document.createElement('label');
                        productValue.textContent = formatAsCurrency(product.valor); 
                        productContainer.appendChild(productValue); 
                    }

                    const productLink = document.createElement('a');
                    productLink.href = `/products/${product.id}`; 
                    productLink.appendChild(productContainer);

                    const productItem = document.createElement('div');
                    productItem.classList.add('product_item'); 

                    productItem.appendChild(productLink);

                    container.appendChild(productItem); 
                });
            })
            .catch(error => console.error('Error fetching products:', error));
    </script>

</body>
</html>
